<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <meta name="referrer" content="strict-origin-when-cross-origin" />
  <title>BG Video</title>

  <style>
    :root{
      --vhpx: 1px;      /* 1% of viewport height in px (set by JS) */
      --wrap-w: 100vw;  /* wrapper width in px (set by JS) */
      --wrap-h: 100vh;  /* wrapper height in px (set by JS) */
    }

    html, body {
      margin: 0 !important;
      padding: 0 !important;
      width: 100% !important;
      height: 100% !important;
      overflow: hidden !important;
      background: #000;
    }

    /* Visible hero area */
    .bg-wrap {
      position: fixed;
      left: 0;
      right: 0;
      top: 0;
      height: calc(var(--vhpx) * 100);
      overflow: hidden;
      background: #000;
    }

    /* Desktop: make it ~90% height and centered */
    @media (min-width: 900px) {
      .bg-wrap {
        top: calc(var(--vhpx) * 5);
        height: calc(var(--vhpx) * 90);
      }
    }

    /* Cover sizing based on measured wrapper (no bars) */
    #playerShell {
      position: absolute;
      top: 50%;
      left: 50%;

      /* 16:9 cover math using decimals (no calc division) */
      width:  max(var(--wrap-w), calc(var(--wrap-h) * 1.7777778));  /* 16/9 */
      height: max(calc(var(--wrap-w) * 0.5625), var(--wrap-h));     /* 9/16 */

      transform: translate(-50%, -50%) scale(1.02);
      transform-origin: center center;
      pointer-events: none; /* prevents tap overlays */
    }

    /* iPhone: crop top overlay more aggressively */
    @media (max-width: 768px) {
      #playerShell {
        transform: translate(-50%, -50%) translateY(-12%) scale(1.22);
      }
    }

    #playerShell iframe {
      width: 100% !important;
      height: 100% !important;
      border: 0 !important;
      display: block;
    }
  </style>
</head>

<body>
  <div class="bg-wrap" id="wrap">
    <div id="playerShell">
      <div id="player"></div>
    </div>
  </div>

  <script src="https://www.youtube.com/iframe_api"></script>

  <script>
    const videoId = "sYsGr3S-6-k";
    let player;

    function setViewportVars() {
      const vv = window.visualViewport;
      const h = (vv && vv.height) ? vv.height : window.innerHeight;
      document.documentElement.style.setProperty("--vhpx", (h * 0.01) + "px");

      const wrap = document.getElementById("wrap");
      if (!wrap) return;

      const r = wrap.getBoundingClientRect();
      document.documentElement.style.setProperty("--wrap-w", r.width + "px");
      document.documentElement.style.setProperty("--wrap-h", r.height + "px");
    }

    function requestBestQuality() {
      try { player.setPlaybackQuality("hd1080"); } catch (e) {}
      setTimeout(() => { try { player.setPlaybackQuality("hd720"); } catch (e) {} }, 1200);
    }

    // Keep sizing correct when iOS address bar expands/collapses
    window.addEventListener("resize", () => requestAnimationFrame(setViewportVars));
    window.addEventListener("orientationchange", () => setTimeout(setViewportVars, 250));
    if (window.visualViewport) {
      window.visualViewport.addEventListener("resize", () => requestAnimationFrame(setViewportVars));
      window.visualViewport.addEventListener("scroll", () => requestAnimationFrame(setViewportVars));
    }

    // Run once after layout is ready
    window.addEventListener("DOMContentLoaded", () => {
      setViewportVars();
      setTimeout(setViewportVars, 100);
    });

    // Must be global for the iframe_api callback
    window.onYouTubeIframeAPIReady = function () {
      setViewportVars();

      player = new YT.Player("player", {
        videoId,
        playerVars: {
          autoplay: 1,
          mute: 1,
          playsinline: 1,
          controls: 0,
          modestbranding: 1,
          rel: 0,
          loop: 1,
          playlist: videoId,
          iv_load_policy: 3,
          disablekb: 1,
          origin: window.location.origin,
          vq: "hd1080"
        },
        events: {
          onReady: (e) => {
            e.target.playVideo();
            requestBestQuality();
            setTimeout(requestBestQuality, 2500);
          }
        }
      });
    };
  </script>
</body>
</html>
